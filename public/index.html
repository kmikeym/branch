<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Branch - Build more fast together</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <nav class="top-nav">
    <div class="nav-left">
      <div class="logo-link" style="cursor: default;">
        <span class="logo-icon">üå≥</span>
        <span class="logo-text">Branch</span>
      </div>
    </div>
    <div class="nav-right" id="nav-user-info">
      <button onclick="showPermissionsModal()" class="btn-primary" style="border: none; cursor: pointer;">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        Login
      </button>
    </div>
  </nav>

  <div class="container">
    <div class="landing-hero">
      <h1>Mapping the creative network of code.</h1>
      <p class="landing-tagline">Branch connects people building at the intersection of AI and code ‚Äî developers who experiment, remix, and create new tools.</p>

      <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
        <a href="#vibe-coding-section" class="btn-secondary btn-large" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
          üé® Explore AI Creators
        </a>
        <button onclick="showPermissionsModal()" class="btn-primary btn-large" style="border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
          <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          Scan Your GitHub
        </button>
      </div>
    </div>

    <div class="landing-stats">
      <div class="stat-card">
        <span class="stat-number" id="total-users">-</span>
        <span class="stat-label">Developers</span>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="authenticated-users">-</span>
        <span class="stat-label">Users</span>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="total-repos">-</span>
        <span class="stat-label">Repositories</span>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="total-tech">-</span>
        <span class="stat-label">Technologies</span>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 48px;">
      <div class="landing-section" style="margin-bottom: 0;">
        <h2>Recent Users</h2>
        <div id="recent-auth-users" class="social-grid">
          <div class="loading-placeholder">Loading...</div>
        </div>
      </div>

      <div class="landing-section" style="margin-bottom: 0;">
        <h2>Recently Scanned</h2>
        <div id="recent-scanned" class="social-grid">
          <div class="loading-placeholder">Loading...</div>
        </div>
      </div>
    </div>

    <div class="landing-section" id="vibe-coding-section">
      <h2>üé® Vibe Coding</h2>
      <p style="color: #666; margin-bottom: 20px;">Developers building with AI assistance</p>
      <div id="vibe-coding-tech" class="tech-tags">
        <div class="loading-placeholder">Loading...</div>
      </div>
    </div>

    <div class="landing-section">
      <h2>Popular Technologies</h2>
      <div id="popular-tech" class="tech-tags">
        <div class="loading-placeholder">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Permissions Modal -->
  <div id="permissions-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üîê Login with GitHub</h2>
        <button class="modal-close" onclick="closePermissionsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <h3 style="margin-top: 0;">What we're asking for:</h3>
        <div style="background: #f5f5f5; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
          <p style="margin: 0; font-weight: 500;">‚úÖ Basic profile access (read:user)</p>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 0.9em;">Your username, avatar, and public profile info</p>
        </div>

        <h3>Why we need it:</h3>
        <ul style="margin: 12px 0; padding-left: 20px; color: #666;">
          <li style="margin-bottom: 8px;">GitHub limits unauthenticated requests to <strong>60/hour</strong></li>
          <li style="margin-bottom: 8px;">Authenticated users get <strong>5,000/hour</strong> ‚Äî enough to scan profiles</li>
          <li>We only access your public data (repos, followers, tech stack)</li>
        </ul>

        <h3>What we DON'T access:</h3>
        <ul style="margin: 12px 0; padding-left: 20px; color: #666;">
          <li style="margin-bottom: 8px;">‚ùå Private repositories</li>
          <li style="margin-bottom: 8px;">‚ùå Email addresses</li>
          <li style="margin-bottom: 8px;">‚ùå Ability to modify your account</li>
          <li>‚ùå Ability to write to your repos</li>
        </ul>

        <div style="margin-top: 24px; display: flex; gap: 12px;">
          <a href="/api/auth/github" class="btn-primary" style="flex: 1; text-align: center; text-decoration: none;">Continue to GitHub</a>
          <button onclick="closePermissionsModal()" class="btn-secondary" style="flex: 1;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Permissions modal functions
    function showPermissionsModal() {
      document.getElementById('permissions-modal').classList.remove('hidden');
    }

    function closePermissionsModal() {
      document.getElementById('permissions-modal').classList.add('hidden');
    }

    // Close modal when clicking outside of it
    document.getElementById('permissions-modal')?.addEventListener('click', function(event) {
      if (event.target.id === 'permissions-modal') {
        closePermissionsModal();
      }
    });

    // Check if user is logged in and update nav
    async function updateNav() {
      const loggedInUser = localStorage.getItem('loggedInUser');

      if (loggedInUser) {
        try {
          const techResponse = await fetch(`/api/techstack?username=${loggedInUser}`);
          const techData = await techResponse.json();

          document.getElementById('nav-user-info').innerHTML = `
            <div class="nav-user-info">
              <a href="/dashboard.html?user=${loggedInUser}" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
                <img src="${techData.avatar_url || `https://github.com/${loggedInUser}.png`}" alt="${loggedInUser}" class="nav-avatar">
                <span class="nav-username">@${loggedInUser}</span>
              </a>
              <a href="/" class="nav-logout" onclick="localStorage.removeItem('loggedInUser')">Logout</a>
            </div>
          `;
        } catch (error) {
          // Fallback if we can't get avatar
          document.getElementById('nav-user-info').innerHTML = `
            <div class="nav-user-info">
              <a href="/dashboard.html?user=${loggedInUser}" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
                <img src="https://github.com/${loggedInUser}.png" alt="${loggedInUser}" class="nav-avatar">
                <span class="nav-username">@${loggedInUser}</span>
              </a>
              <a href="/" class="nav-logout" onclick="localStorage.removeItem('loggedInUser')">Logout</a>
            </div>
          `;
        }
      }
    }

    // Load homepage stats
    async function loadStats() {
      try {
        const response = await fetch('/api/stats');
        const data = await response.json();

        if (response.ok) {
          document.getElementById('total-users').textContent = data.total_users;
          document.getElementById('authenticated-users').textContent = data.authenticated_users;
          document.getElementById('total-repos').textContent = data.total_repos;
          document.getElementById('total-tech').textContent = data.total_technologies;

          // Display recent authenticated users
          const recentAuthUsersContainer = document.getElementById('recent-auth-users');
          if (data.recent_auth_users && data.recent_auth_users.length > 0) {
            recentAuthUsersContainer.innerHTML = data.recent_auth_users.map(user => `
              <a href="/dashboard.html?user=${user.username}" class="social-card" title="${user.username}">
                <img src="${user.avatar_url}" alt="${user.username}" class="${user.user_type || 'unscanned'}">
                <span>${user.username}</span>
              </a>
            `).join('');
          } else {
            recentAuthUsersContainer.innerHTML = '<p class="empty-state">No users yet. Be the first!</p>';
          }

          // Display recently scanned
          const recentScannedContainer = document.getElementById('recent-scanned');
          if (data.recent_scanned && data.recent_scanned.length > 0) {
            recentScannedContainer.innerHTML = data.recent_scanned.map(user => `
              <a href="/dashboard.html?user=${user.username}" class="social-card" title="${user.username}">
                <img src="${user.avatar_url}" alt="${user.username}" class="${user.user_type || 'unscanned'}">
                <span>${user.username}</span>
              </a>
            `).join('');
          } else {
            recentScannedContainer.innerHTML = '<p class="empty-state">No scans yet</p>';
          }

          // Filter vibe coding technologies (AI-related tools and tags)
          const vibeCodingTools = ['Claude', 'Claude Code', 'ChatGPT', 'GitHub Copilot', 'Cursor', 'AI Assisted', 'Vibe Coder'];
          const vibeCodingTech = data.popular_tech.filter(tech =>
            vibeCodingTools.includes(tech.name)
          );

          // Display vibe coding technologies
          const vibeCodingContainer = document.getElementById('vibe-coding-tech');
          if (vibeCodingTech && vibeCodingTech.length > 0) {
            vibeCodingContainer.innerHTML = vibeCodingTech.map(tech => `
              <a href="/tech.html?tag=${encodeURIComponent(tech.name)}" class="tech-tag tech-tag-${tech.color}">
                ${tech.name} <span class="tech-tag-count">${tech.user_count}</span>
              </a>
            `).join('');
          } else {
            vibeCodingContainer.innerHTML = '<p class="empty-state">No vibe coders yet. Be the first!</p>';
          }

          // Display popular technologies (excluding vibe coding tools to avoid duplication)
          const nonVibeTech = data.popular_tech.filter(tech =>
            !vibeCodingTools.includes(tech.name)
          );

          const popularTechContainer = document.getElementById('popular-tech');
          if (nonVibeTech && nonVibeTech.length > 0) {
            popularTechContainer.innerHTML = nonVibeTech.map(tech => `
              <a href="/tech.html?tag=${encodeURIComponent(tech.name)}" class="tech-tag tech-tag-${tech.color}">
                ${tech.name} <span class="tech-tag-count">${tech.user_count}</span>
              </a>
            `).join('');
          } else {
            popularTechContainer.innerHTML = '<p class="empty-state">No technologies yet</p>';
          }
        }
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // Load on page load
    updateNav();
    loadStats();
  </script>
</body>
</html>
